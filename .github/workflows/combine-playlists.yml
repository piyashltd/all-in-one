name: Combine M3U Playlists

on:
  # এই workflow কখন রান করবে?
  push:
    branches:
      - main  # আপনার প্রধান ব্রাঞ্চের নাম যদি 'master' হয়, তবে এটি পরিবর্তন করুন
    paths:
      # শুধুমাত্র এই ফাইলগুলো পরিবর্তন হলেই রান করবে
      - 'channels.m3u'
      - 'movies.m3u'
      - 'series.m3u'
      # এখানে আপনার অন্য সব M3U ফাইলের নাম যোগ করুন

# **এটিই মূল সমাধান: GitHub Actions-কে আপনার রেপোজিটরিতে লেখার (Write) অনুমতি দেবে**
permissions:
  contents: write 

jobs:
  build:
    runs-on: ubuntu-latest # একটি লিনাক্স সার্ভারে রান হবে

    steps:
      # ১. কোডগুলো সার্ভারে ডাউনলোড করা
      - name: Checkout repository
        uses: actions/checkout@v4
        # GITHUB_TOKEN ব্যবহার করে Write পারমিশন নিশ্চিত করা
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # ২. প্লেলিস্ট ফাইলগুলো একত্রিত করা
      - name: Combine M3U files
        run: |
          # master.m3u ফাইলটি তৈরি শুরু করুন এবং একটি হেডার দিন
          echo '#EXTM3U x-tvg-url="YOUR_EPG_URL_HERE.xml"' > master.m3u
          
          # প্রতিটি ফাইল থেকে #EXTM3U হেডারটি বাদ দিয়ে বাকি অংশ master.m3u তে যোগ করুন
          grep -v "#EXTM3U" channels.m3u >> master.m3u
          grep -v "#EXTM3U" movies.m3u >> master.m3u
          grep -v "#EXTM3U" series.m3u >> master.m3u
          # আপনার যতগুলো ফাইল আছে, সবগুলো এখানে যোগ করুন
          
          echo "✅ Playlists combined successfully."

      # ৩. পরিবর্তনগুলো স্বয়ংক্রিয়ভাবে কমিট করা ও পুশ করা
      # যেহেতু 'contents: write' পারমিশন যোগ করা হয়েছে, এটি আর ফেইল করবে না।
      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Auto-update master.m3u playlist"
          file_pattern: master.m3u # শুধুমাত্র master.m3u ফাইলটি কমিট করো
          commit_options: '--no-verify'
